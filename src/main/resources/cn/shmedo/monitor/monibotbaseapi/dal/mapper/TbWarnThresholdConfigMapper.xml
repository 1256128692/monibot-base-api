<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.shmedo.monitor.monibotbaseapi.dal.mapper.TbWarnThresholdConfigMapper">

    <select id="getInfoById" resultType="cn.shmedo.monitor.monibotbaseapi.model.dto.datawarn.WarnThresholdConfig">
        SELECT twhc.ID,
               twhc.CompanyID,
               twhc.Platform,
               twhc.ProjectID,
               twhc.MonitorType,
               twhc.MonitorItemID,
               twhc.CompareMode,
               twhc.SensorID,
               twhc.FieldID,
               twhc.`Enable`,
               twhc.WarnName,
               twhc.`Value`,
               twhc.ExValue,
               tpi.ProjectName projectName,
               tpi.ShortName   projectShortName,
               ts.Alias        sensorName,
               tmp.`Name`      monitorPointName,
               tmtf.FieldName  fieldName,
               tdu.EngUnit     fieldUnitEng
        FROM `tb_warn_threshold_config` twhc
                 LEFT JOIN tb_project_info tpi ON twhc.ProjectID = tpi.ID
                 LEFT JOIN tb_sensor ts ON twhc.SensorID = ts.ID
                 LEFT JOIN tb_monitor_point tmp ON tmp.ID = ts.MonitorPointID
                 LEFT JOIN tb_monitor_type_field tmtf ON twhc.FieldID = tmtf.ID
                 LEFT JOIN tb_data_unit tdu ON tmtf.FieldUnitID = tdu.ID
        <where>
            twhc.ID = #{id}
        </where>
    </select>
    <select id="selectMonitorWithThresholdConfigCountByProjectID"
            resultType="cn.shmedo.monitor.monibotbaseapi.model.response.warnConfig.MonitorWithThresholdConfigCountInfo">
        SELECT
            mi.`ID` id,
            mi.`Name` 'name',
            mi.`Alias` alias,
            mi.`Enable` 'enable',
            mi.`MonitorType` monitorType,
            mi.`MonitorClass` monitorClass,
            COUNT(wtc.`ID`) configCount
        FROM
            tb_monitor_item mi
            LEFT JOIN tb_warn_threshold_config wtc ON wtc.`MonitorItemID` = mi.`ID` AND wtc.`Enable` IS TRUE
        WHERE mi.`ProjectID`=#{projectID}
        GROUP BY mi.`ID`
    </select>
</mapper>